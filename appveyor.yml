version: '{build}'

init:
- git config --global core.autocrlf input

environment:
  matrix:
  - QT5: C:\Qt\5.9.1\mingw53_32
    MINGW: C:\Qt\Tools\mingw530_32

matrix:
  fast_finish: true

cache:
  build/libs

before_build:
- set PATH=%MINGW%\bin;%QT5%\bin;%PATH%

build_script:
- mkdir .\build
- cd .\build
- mkdir -p .\app\build\plugins

# Build Praaline
- qmake -v
- qmake ..\Praaline.pro CONFIG+=release && mingw32-make
- dir /s

# Package
- cd ..
- mkdir deploy
- copy build\app\build\praaline.exe deploy\praaline.exe
- copy build\pncore\build\release\pncore.dll deploy\pncore.dll
- windeployqt --release deploy/praaline.exe
- windeployqt --release deploy/pncore.dll
- 7z a Praaline_win_%arch%.zip .\deploy\*

artifacts:
- path: Praaline_win_$(arch).zip

